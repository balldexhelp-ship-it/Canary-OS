<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Canary-OS Terminal</title>
<style>
  body {
    margin: 0;
    font-family: monospace;
    background: black;
    color: #00FF00;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  #terminal {
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
  }

  #output {
    flex: 1;
    white-space: pre;
    overflow-y: auto;
    padding: 5px;
    margin: 0;
  }

  #input-line {
    display: flex;
    border-top: 1px solid #00FF00;
    padding: 2px 5px;
  }

  #input-line span {
    margin-right: 5px;
  }

  #command-input {
    background: black;
    border: none;
    color: #00FF00;
    font-family: monospace;
    outline: none;
    flex: 1;
    font-size: 1em;
  }

  #command-input:focus {
    outline: 2px solid #00FF00;
  }

  #output::-webkit-scrollbar {
    width: 6px;
  }
  #output::-webkit-scrollbar-thumb {
    background-color: #00FF00;
  }

</style>
</head>
<body>

<div id="terminal">
  <div id="output">
Welcome to Canary-OS Terminal!
Type `help` for commands.

Commands available:
- games → enter Games menu
- clear → clears screen
  </div>

  <div id="input-line">
    <span>&gt;</span>
    <input id="command-input" type="text" autofocus placeholder="Type a command">
  </div>
</div>

<script>
const output = document.getElementById('output');
const input = document.getElementById('command-input');

let currentSection = null; // null, "games", "tictactoe", "guessnumber", "rps"

// Tic Tac Toe variables
let ticTacToeBoard = ['1','2','3','4','5','6','7','8','9'];

// Guess Number variables
let guessNumberTarget = null;

// Rock Paper Scissors variables
const rpsOptions = ['rock','paper','scissors'];

function appendOutput(text) {
  output.textContent += '\n' + text;
  output.scrollTop = output.scrollHeight;
}

// ---------- Tic Tac Toe functions ----------
function displayTicTacToe() {
  appendOutput(`
 ${ticTacToeBoard[0]} | ${ticTacToeBoard[1]} | ${ticTacToeBoard[2]}
---+---+---
 ${ticTacToeBoard[3]} | ${ticTacToeBoard[4]} | ${ticTacToeBoard[5]}
---+---+---
 ${ticTacToeBoard[6]} | ${ticTacToeBoard[7]} | ${ticTacToeBoard[8]}
`);
}

function checkTicTacToeWinner() {
  const b = ticTacToeBoard;
  const lines = [
    [0,1,2],[3,4,5],[6,7,8],
    [0,3,6],[1,4,7],[2,5,8],
    [0,4,8],[2,4,6]
  ];
  for(const line of lines){
    const [a,b1,c] = line;
    if(b[a]===b[b1] && b[a]===b[c]) return b[a];
  }
  if(!b.some(c => c !== 'X' && c !== 'O')) return 'Tie';
  return null;
}

function ticTacToeComputerMove() {
  const available = ticTacToeBoard.map((v,i)=> (v!=='X' && v!=='O') ? i : null).filter(v=>v!==null);
  if(available.length===0) return;
  const move = available[Math.floor(Math.random()*available.length)];
  ticTacToeBoard[move] = 'O';
}

// ---------- Input handler ----------
input.addEventListener('keydown', function(e){
  if(e.key!=='Enter') return;
  const command = input.value.toLowerCase().trim();
  input.value = '';

  // --- Tic Tac Toe section ---
  if(currentSection==='tictactoe'){
    if(command.startsWith('user/place=')){
      const num = parseInt(command.split('=')[1])-1;
      if(isNaN(num) || num<0 || num>8){
        appendOutput('Invalid number! Use 1 to 9.');
        return;
      }
      if(ticTacToeBoard[num]==='X' || ticTacToeBoard[num]==='O'){
        appendOutput('That space is already taken.');
        return;
      }
      ticTacToeBoard[num]='X';
      let winner = checkTicTacToeWinner();
      if(winner){
        displayTicTacToe();
        if(winner==='X') appendOutput('You won!');
        else if(winner==='O') appendOutput('Computer won!');
        else appendOutput('It\'s a tie!');
        currentSection = null;
        return;
      }
      ticTacToeComputerMove();
      winner = checkTicTacToeWinner();
      displayTicTacToe();
      if(winner){
        if(winner==='X') appendOutput('You won!');
        else if(winner==='O') appendOutput('Computer won!');
        else appendOutput('It\'s a tie!');
        currentSection = null;
        return;
      }
    } else if(command==='exit'){
      currentSection = null;
      appendOutput('Exited Tic Tac Toe.');
    } else {
      appendOutput('Unknown command in Tic Tac Toe. Use user/place=NUM or exit.');
    }
    return;
  }

  // --- Guess Number section ---
  if(currentSection==='guessnumber'){
    if(command==='exit'){
      currentSection=null;
      appendOutput('Exited Guess Number.');
      return;
    }
    const guess = parseInt(command);
    if(isNaN(guess)){
      appendOutput('Type a number between 1 and 100, or exit.');
      return;
    }
    if(guess<guessNumberTarget) appendOutput('Too low!');
    else if(guess>guessNumberTarget) appendOutput('Too high!');
    else{
      appendOutput('Correct! You guessed the number!');
      currentSection=null;
    }
    return;
  }

  // --- Rock Paper Scissors section ---
  if(currentSection==='rps'){
    if(command==='exit'){
      currentSection=null;
      appendOutput('Exited Rock Paper Scissors.');
      return;
    }
    if(!rpsOptions.includes(command)){
      appendOutput('Type rock, paper, or scissors, or exit.');
      return;
    }
    const compChoice = rpsOptions[Math.floor(Math.random()*3)];
    appendOutput(`Computer chose: ${compChoice}`);
    if(command===compChoice) appendOutput('It\'s a tie!');
    else if(
      (command==='rock' && compChoice==='scissors')||
      (command==='paper' && compChoice==='rock')||
      (command==='scissors' && compChoice==='paper')
    ) appendOutput('You win!');
    else appendOutput('You lose!');
    return;
  }

  // --- Global commands ---
  if(command==='help'){
    appendOutput('Global commands:\n- games\n- clear\n- exit');
  } else if(command==='clear'){
    output.textContent='';
  } else if(command==='games'){
    currentSection='games';
    appendOutput('Games Menu:\n1. Tic Tac Toe\n2. Guess Number\n3. Rock Paper Scissors\nType the game name to play.');
  } else if(currentSection==='games'){
    if(command==='tictactoe'){
      currentSection='tictactoe';
      ticTacToeBoard=['1','2','3','4','5','6','7','8','9'];
      appendOutput('Tic Tac Toe!\nYou are X, computer is O.\nUse user/place=NUM to place X.\nBoard positions 1 to 9:');
      displayTicTacToe();
    } else if(command==='guess number'){
      currentSection='guessnumber';
      guessNumberTarget = Math.floor(Math.random()*100)+1;
      appendOutput('Guess Number!\nType a number between 1 and 100. Type exit to leave.');
    } else if(command==='rock paper scissors'){
      currentSection='rps';
      appendOutput('Rock Paper Scissors!\nType rock, paper, or scissors. Type exit to leave.');
    } else {
      appendOutput('Unknown game. Available games: tictactoe, guess number, rock paper scissors.');
    }
  } else {
    appendOutput('Unknown command: ' + command);
  }
});
</script>

</body>
</html>